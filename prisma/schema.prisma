generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Country {
  iso3            String                    @id
  name            String
  region          String
  indicatorValues CountryIndicatorValue[]   
  computedScores  ComputedScore[]           
  }

model Indicator {
  id             String  @id
  name           String
  theme          String
  scaleMin       Float
  scaleMax       Float
  higherIsBetter Boolean
  sourceName     String
  sourceUrl      String

  values CountryIndicatorValue[]

  @@map("indicators")
}

model CountryIndicatorValue {
  id          Int       @id @default(autoincrement())
  iso3        String
  indicatorId String
  year        Int
  value       Float
  valueNorm   Float
  country     Country   @relation(fields: [iso3], references: [iso3])  
  indicator   Indicator @relation(fields: [indicatorId], references: [id]) 

  @@unique([iso3, indicatorId, year])
  @@index([iso3])
  @@index([indicatorId])
}

model WeightProfile {
  id      String @id
  name    String
  weights String

  computedScores ComputedScore[]

  @@map("weight_profiles")
}

model ComputedScore {
  iso3          String
  profileId     String
  year          Int
  score         Float
  coverageRatio Float

  country Country       @relation(fields: [iso3], references: [iso3], onDelete: Cascade)
  profile WeightProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@id([iso3, profileId, year])
  @@map("computed_scores")
}